<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="icon" href="img/player/player.png">
	<title>シロクマくんのぼうけん</title>
	<link rel="stylesheet" href="style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<style>
	div{
		text-align: center;
		margin-top: 1%;
		margin-left: 1%;
		margin-right: 1%;
	}
	p{
		margin: none;
	}
	#stage{
		text-align: center;
		background-color: rgba(119, 160, 207, 0.3);
	}
	#container{
		margin-top: none;
		display: flex;
		justify-content: center;
		align-items: center;
		flex-wrap: wrap;
	}
	#move,#count{
		text-align: left;
		margin-left: 5%;
	}
	.audio_wrap{
		margin: 0%;
	}
	.audio_button {
		width: 20px;
		height: 20px;
		margin-top: 1%;
		margin-left: 1%;
		background: url(img/command/bgm.png)no-repeat;
		background-size: contain;
	}
  	.play .audio_button {
    	background-image: url(img/command/bgm_off.png);
  	}
	.flex{
        background-color: none;
		position: absolute;
        display: flex;
        justify-content: right;
        margin-top: 0%;
    }
</style>

<body>
	<div id ="site-box">
		<p id="stage">ステージ 7　あたらしいバケツをゲットしよう！</p>
		<div class="flex">
		<div class="audio_wrap">
			<div class="audio_button">
				<audio id="audio" src="music/natsuyasuminotanken.mp3" loop>
					あなたのブラウザーは<code>audio</code>要素をサポートしていません。</audio>
			</div>
		</div>

		<label class="open" for="pop-up"><img src="img/command/gamerule.png" width="20px" height="20px"></label>
			<input type="checkbox" id="pop-up">
				<div class="overlay">
					<div class="window">
						<br><br><br>
						<button id="pub">あそびかた</button>
						<p id="way"></p>
						<button id="pub2">ヒント</button>
						<p id="hint"></p>
						<label class="close" for="pop-up">×</label>
					</div>
				</div>
		</div>
				<audio id="SE"preload="auto"><source src="music/SE.mp3" type="audio/mp3"></audio>
		<form action="#" name="form1"></form>
		<p id=comment><span class="under">シロクマくんを１ばんすくない<ruby>数<rt>かず</rt></ruby>でゴールまでうごかそう！</span></p>
		<br>
		<div><canvas id="canvas"></canvas></div>
			<div>
				<button type="button" id="left"><img src="img/command/left.png" id="左"></button>
				<button type="button" id="right"><img src="img/command/right.png" id="右"></button>
				<button type="button" id="up"><img src="img/command/up.png" id="上"></button>
				<button type="button" id="down"><img src="img/command/down.png" id="下"></button>
				<button type="button" id="act"><img src="img/command/action.png"></button>
				<button type="button" id="again"><img src="img/command/restart.png"></button>
				<button type="button" id="again_data"><img src="img/command/restart_data.png"></button>
				<!-- 一つ選択消すボタン -->
				<button type="button" id="del"><img src="img/command/del.png"></button>
				<button type="button" id="attack"><img src="img/command/attack.png"></button>
				<button type="button" id="attack2"><img src="img/command/attack2.png"></button>
			</div>
	</div>

<script>
	document.getElementById("again_data").hidden=true;//データ残しながらやり直すボタン

	var count = 0;
	var line = [];
	var image = {"右":"<img src='img/command/right.png' width=3%>", 
				"左":"<img src='img/command/left.png' width=3%>", 
				"上":"<img src='img/command/up.png' width=3%>",
				"下":"<img src='img/command/down.png' width=3%>",
				"攻撃":"<img src='img/command/attack.png' width=3%>",
				"攻撃2":"<img src='img/command/attack2.png' width=3%>"}

	document.getElementById("right").onclick = function () {
		count++;
		document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;
		line.push("右"); 
		console.log(line);
		document.getElementById("move").innerHTML = "シロクマくんのうごき：" + image[line[0]];
		rewrite();
	};
	document.getElementById("left").onclick = function () {
		count++;
		document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;
		line.push("左");
		console.log(line);
		document.getElementById("move").innerHTML = "シロクマくんのうごき：" + image[line[0]];
		rewrite();
	};
	document.getElementById("up").onclick = function () {
		count++;
		document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;
		line.push("上");
		console.log(line);
		document.getElementById("move").innerHTML = "シロクマくんのうごき：" + image[line[0]];
		rewrite();
	};
	document.getElementById("down").onclick = function () {
		count++;
		document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;
		line.push("下");
		console.log(line);
		document.getElementById("move").innerHTML = "シロクマくんのうごき：" + image[line[0]];
		rewrite();
	};
	document.getElementById("attack").onclick = function () {
		document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;
		line.push("攻撃");
		console.log(line);
		document.getElementById("move").innerHTML = "シロクマくんのうごき：" + image[line[0]];
		rewrite();
	};
	document.getElementById("attack2").onclick = function () {
		document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;
		line.push("攻撃2");
		console.log(line);
		document.getElementById("move").innerHTML = "シロクマくんのうごき：" + image[line[0]];
		rewrite();
	};

	document.getElementById("again").onclick = function () {
	document.getElementById("right").hidden = false;
	document.getElementById("left").hidden = false;
	document.getElementById("up").hidden = false;
	document.getElementById("down").hidden = false;
	document.getElementById("act").hidden = false;
	document.getElementById("attack").hidden = false;
	document.getElementById("attack2").hidden = false;
	document.getElementById("del").hidden = false;

	count = 0;
	document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;

	line.length = 0;
	console.log(line);
	document.getElementById("move").innerHTML = "シロクマくんのうごき："
	
	player.move = 0;
	get_enemy();
	player.x = 48;
	player.y = 48;
	};

	//データ残してやり直す処理
	document.getElementById("again_data").onclick = function () {
	document.getElementById("again_data").hidden = true;
	document.getElementById("right").hidden = false;
	document.getElementById("left").hidden = false;
	document.getElementById("up").hidden = false;
	document.getElementById("down").hidden = false;
	document.getElementById("act").hidden = false;
	document.getElementById("del").hidden = false;
	document.getElementById("again").hidden = false;
	document.getElementById("attack").hidden = false;
	document.getElementById("attack2").hidden = false;
	document.getElementById("comment").innerHTML = "<p id=comment><span class='under'>シロクマくんを１ばんすくない<ruby>数<rt>かず</rt></ruby>でゴールまでうごかそう！</span></p>";

	get_enemy();
	player.x = 48;
	player.y = 48;
	player.move = 0;
	};

	//一つ選択消す処理
	document.getElementById("del").onclick = function () {
		line.pop();//line配列末尾削除
		console.log(line);
		if(count>0){
			count-=1;//移動回数一つ減らす
		}
		if(count===0){
			document.getElementById("move").innerHTML = "シロクマくんのうごき：";
		}
		document.getElementById("count").innerHTML = "シロクマくんのうごくかず：" + count;
		
		if (line.length > 0) {
			document.getElementById("move").innerHTML = "シロクマくんのうごき：";
			for (let j = 0; j < line.length; j++) {
				var url=image[line[j]];
				document.getElementById("move").innerHTML += url;
			}
		}
	};

	function rewrite() {
		if (line.length > 1) {
			for (let j = 1; j < line.length; j++) {
				var url=image[line[j]];
				document.getElementById("move").innerHTML += url;
			}
		}
	}

	$(function () {
		var audioBtn = $(".audio_button"),
		audioWrap = $(".audio_wrap"),
		audio = document.getElementById("audio");
			
		audioBtn.on("click", function () {
		if( audioWrap.hasClass("play") ) {
		audio.pause();
		audioWrap.removeClass("play");
		} else {
		audio.play();
		audioWrap.addClass("play");
		}
		});
	});

	$("button").on("click",　function(){
		SE.currentTime = 0;
		SE.play();
	});

	//あそびかたボタンクリック処理
	var pub_count=0;
	document.getElementById("pub").onclick = function () {
		pub_count++;
		document.getElementById("way").innerHTML = "<ul id='list'>"
			+"<li class='item'>"+"<img src='img/command/left.png' width='20'>　ひだりに１マスすすむ"+"</li>"
			+"<li class='item'>"+"<img src='img/command/right.png' width='20'>　みぎに１マスすすむ"+"</li>"
			+"<li class='item'>"+"<img src='img/command/up.png' width='20'>　	うえに１マスすすむ"+"</li>"
			+"<li class='item'>"+"<img src='img/command/down.png' width='20'>　したに１マスすすむ"+"</li>"
			+"<li class='item'>"+"<img src='img/command/del.png' width='20'>　うごきをひとつけす"+"</li>"
			+"<li class='item'>"+"<img src='img/command/restart.png' width='20'>　うごきをぜんぶけす"+"</li>"
			+"<li class='item'>"+"<img src='img/command/bgm.png' width='20'>　おんがくをながす"+"</li>"
			+"<li class='item'>"+"<img src='img/command/bgm_off.png' width='20'>　おんがくをとめる"+"</li>"
			+"<li class='item'>"+"<img src='img/command/attack.png' width='20'>"+"<img src='img/command/fire1.png' width='20'>　をけせるバケツ"+"</li>"
			+"<li class='item'>"+"<img src='img/command/attack2.png' width='20'>"+"<img src='img/command/fire2.png' width='20'>　をけせるバケツ"+"</li>"
			+"</ul>"+"<br>"+"<br>"+"<br>"+"<br>"+"<br>"
			+"<br>"+"<br>"
			+"<p>バケツは<ruby>火<rt>ひ</rt></ruby>のあるマスの<span class='under2'>1マスまえのマスでつかおう！</span></p>"
			+"<span class='under'>シロクマくんはまとめてしかうごけないよ！</span>";
			if(pub_count%2==0){//再度押したら非表示
				document.getElementById("way").innerHTML = "";
			}
	};
	
	$('.close').on('click', function() {
		document.getElementById("way").innerHTML = "";
		document.getElementById("hint").innerHTML = "";
		pub2_count=0;
	});
</script>

		<p1 id=move>シロクマくんのうごき：</p1><br>
		<p2 id=count>シロクマくんのうごくかず：０</p2>

<script type="text/javascript" src="js/findShortestPath.js"></script>
<script type="text/javascript" src="js/scriptstage7_last.js"></script>
</body>
</html>